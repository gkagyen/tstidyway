{
  "hash": "63097748e04380dbe1cfcb931b9437d0",
  "result": {
    "engine": "knitr",
    "markdown": "# Tidy Time Series Basics {#sec-tidy-time-series-basics}\n\nAt its core, a time series is just a data where *when* it was collected is a crucial part of the story. It is a sequence of data points indexed in time and order. Regardless, a time series should still be a *tidy* data frame. In a *tidy dataset* (following Hadley Wickham's principles), Each **row** is an **observation,** each **column** is a **variable.**\n\n\n\nAt its core, a time series is just a data where *when* it was collected is a crucial part of the story. It is a sequence of data points indexed in time and order. Regardless, a time series should still be a *tidy* data frame. In a *tidy dataset* (following Hadley Wickham's principles), Each **row** is an **observation,** each **column** is a **variable.**\n\n## What is a tsibble\n\nA tsibble (short for \"tidy temporal tibble\") is a special data frame for time series. It extends the tibble data structure by formally declaring one column as the **index** (the time variable) and optionally, one or more columns as **key(s)** (unique identifiers for different series)\n\n### Key terminologies\n\n**Index:** The variable (usually a date/time) that defines the time order of observations\n\n**Key:** A variable (or combination of variables) that uniquely identifies different time series within a single table e.g. `country`, `stock_symbol` etc.\n\n**Interval:** The regular frequency of the measurements e.g. daily, monthly, quarterly etc.\n\nTo illustrate what we just discussed below is a standard dataframe with a date column. This data is not time aware yet (not a time series)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 3\n  date       product sales\n  <date>     <chr>   <dbl>\n1 2023-01-01 A         120\n2 2023-01-02 A         145\n3 2023-01-01 B          88\n4 2023-01-02 B         102\n```\n\n\n:::\n:::\n\n\na `tsibble` on the other hand is self-aware. It knows its index and its key, unlocking powerful analysis tool. compare the table below. The \"\\[1D\\]\" beside the tsibble dimension represents the **interval** (daily) and the \"\\[2\\]\" represents the number of unique keys/series.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 4 x 3 [1D]\n# Key:       product [2]\n  date       product sales\n  <date>     <chr>   <dbl>\n1 2023-01-01 A         120\n2 2023-01-02 A         145\n3 2023-01-01 B          88\n4 2023-01-02 B         102\n```\n\n\n:::\n:::\n\n\n## Creating and Converting Data into a `tsibble`\n\ncreating a `tsibble` follows the same procedure as creating a normal data frame using the `tsibble()` function or simply from an existing data frame or tibble using the `as_tsibble()` function.\n\nAs explained earlier, these two functions require you to specify at least one of these two things (**index** or **key**) or both depending on your data.\n\nWe see how to create a tsibble from using `tsibble()` and `as_tsibble` below\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# single time series\ntsibble(\n  year = 2010:2050,\n  value = rnorm(41),\n  index = year\n)\n```\n:::\n\n\nThe above code creates a simple time series data using the `tsibble()` function, exactly like creating a dataframe. Indicating the **index** variable distinguishes a tsibble from a tibble.\n\nNow we will create a tsibble from the `as_tsibble()` function using an existing tibble\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# creating a tsibble from monthly data sales\n# sales come from two different shops\nsales_data <- tibble(\n  Date = ymd(c('2025-01-01','2025-02-01','2025-03-01','2026-04-01','2025-05-01','2025-01-01','2025-02-01','2025-03-01','2025-04-01','2025-05-01')),\n  Store = rep(c('Phone Shop', 'Beauty Shop'), each = 5),\n  Sales = c(225, 150, 130, 90, 220, 190, 145, 180, 110, 180)\n)\nprint(sales_data)\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# We use as_tsibble to convert the tibble to a tsibble\n# the date column becomes the index and the store column the key\nsales_data_ts <- sales_data |> \n  mutate(Date = yearmonth(Date)) |>\n  as_tsibble(\n    index = Date,\n    key = Store\n  )\nprint(sales_data_ts)\n```\n:::\n\n\nWe now have our sales data in a time aware tsibble format. The `yearmonth()` is an index function to represent our **Date** in a **year-month** format.\n\n### Practice tsibble conversion\n\nHere we will learn how to convert real world data into a tsibble. The data we will use is a time series data for Ghana containing certain world bank indicators. The data can be found here [gh_data.csv](https://github.com/gkagyen/tstidyway/blob/main/data/gh_data.csv). The data comes in a wide format (where years are columns). To make it **tidy,** where each row represents one indicator so that we a `year` and `value` column, we first need to reshape it into a **long format**\n\nWe will use `pivot_longer` from `tidyr` to reshape the data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load data\ngh_data_raw <- read_csv('data/gh_data.csv', show_col_types = FALSE) \n  \n# convert wide data to long\ngh_data_long <- gh_data_raw |> \n  pivot_longer(\n    cols = starts_with(c('19','20')), # select all date columns\n    names_to = \"Year\",                # New column for years\n    values_to = 'Value'               # New column for values\n  )\n\n# View the first few rows\nhead(gh_data_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  `Country Name` `Indicator Name` `Indicator Code` Year    Value\n  <chr>          <chr>            <chr>            <chr>   <dbl>\n1 Ghana          Population_total SP.POP.TOTL      1960  6961215\n2 Ghana          Population_total SP.POP.TOTL      1961  7162667\n3 Ghana          Population_total SP.POP.TOTL      1962  7337375\n4 Ghana          Population_total SP.POP.TOTL      1963  7514714\n5 Ghana          Population_total SP.POP.TOTL      1964  7695739\n# ℹ 1 more row\n```\n\n\n:::\n:::\n\n\nSuccess! Now each row is an observation of an indicator in a given year\n\nThe next step is to convert the Year to a Proper Date. Right now `Year` is a character. We need it as a date so `tsibble` can understand time ordering. we will use the `lubridate` package functions and convert it to a Date object (assuming January 1st of each year).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# convert year to date\ngh_data_long <-  gh_data_long |> \n  mutate(\n    Year = as.integer(Year),                       # convert to integer number\n    Date = lubridate::ymd(paste0(Year, \"-01-01\")), # Create date:Jan 1 of each year\n    .after = Year                                  # add new Date column after year column\n  )\n\n# check structure\nstr(gh_data_long$Date)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Date[1:1430], format: \"1960-01-01\" \"1961-01-01\" \"1962-01-01\" \"1963-01-01\" \"1964-01-01\" ...\n```\n\n\n:::\n:::\n\n\nNow `Date` is a proper **Date object** essential for time series analysis.\n\nFinally we can convert our data to a time series dataframe (`tsibble`) that is time aware of - **index** (time)and **keys** (unique series identifiers). In our case the `Date` column is our **index** and the `Indicator_name` becomes our **index** since we have multiple time series -population, life expectancy etc.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# convert data to tsibble\ngh_ts <- gh_data_long |> \n  as_tsibble(\n    index = Date,              # Time index\n    key = `Indicator Name`     # Key column: each indicator is a separate series\n  )\n\n# View the tsibble\ngh_ts\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 1,430 x 6 [1D]\n# Key:       Indicator Name [22]\n  `Country Name` `Indicator Name`       `Indicator Code`   Year Date       Value\n  <chr>          <chr>                  <chr>             <int> <date>     <dbl>\n1 Ghana          Annual GDP growth rate NY.GDP.MKTP.KD.ZG  1960 1960-01-01 NA   \n2 Ghana          Annual GDP growth rate NY.GDP.MKTP.KD.ZG  1961 1961-01-01  3.43\n3 Ghana          Annual GDP growth rate NY.GDP.MKTP.KD.ZG  1962 1962-01-01  4.11\n4 Ghana          Annual GDP growth rate NY.GDP.MKTP.KD.ZG  1963 1963-01-01  4.41\n5 Ghana          Annual GDP growth rate NY.GDP.MKTP.KD.ZG  1964 1964-01-01  2.21\n# ℹ 1,425 more rows\n```\n\n\n:::\n:::\n\n\nWe have our time series tsibble ready! But there are some nuances in the data, the first obvious ones are the column names- `Country Name`, `Indicator Name` and `Indicator Code`-we see that they are surrounded in back ticks `` (`) `` . This tells us that they do not follow the correct naming convention for **variables** in R (no spaces between words). The next one is the interval \\[1D\\]. The tsibble package thinks our data is supposed to be a daily data because we have a full date with month and days available. We will see how to fix this in the next chapter\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}