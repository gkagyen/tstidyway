<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Exploring Patterns with feasts and fabletools – Timeseries Analysis - the Tidyverse Way</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./forecast-prepare.html" rel="next">
<link href="./visualising-trends.html" rel="prev">
<link href="./ts_book.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./exploratory-analysis.html">Exploratory Time Series Analysis</a></li><li class="breadcrumb-item"><a href="./exploring-patterns.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Timeseries Analysis - the Tidyverse Way</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/gkagyen/tstidyway" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./required-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Required Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./environment-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Setting Up Your RStudio Environment</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./tidy-timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Time Series Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timeseries-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tidy Time Series Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timegaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dealing with Time Gaps and Irregularities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Importing Data and Creating a tsibble (Bonus)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dates-and-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Dates and Time</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>lubridate</code> for Date Manipulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./new-time-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating Useful Time-Based Features</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./exploratory-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Time Series Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualising-trends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code>autoplot()</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploring-patterns.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./forecast-prepare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparing for Forecasting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stabilise-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Transformations for Variance Stabilisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./check-stationary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Checking for Stationarity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./split-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Splitting Temporal Data for Modelling</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./forecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting with the fable Framework</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Simple Forecasting Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced Forecasting Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forecast-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Model Evaluation and Forecasting</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#decomposing-a-time-series-with-stl" id="toc-decomposing-a-time-series-with-stl" class="nav-link active" data-scroll-target="#decomposing-a-time-series-with-stl"><span class="header-section-number">10.1</span> Decomposing a Time Series with <code>STL()</code></a>
  <ul class="collapse">
<li><a href="#basic-and-advanced-decomposition-with-special-arguments" id="toc-basic-and-advanced-decomposition-with-special-arguments" class="nav-link" data-scroll-target="#basic-and-advanced-decomposition-with-special-arguments"><span class="header-section-number">10.1.1</span> Basic and Advanced Decomposition with Special Arguments</a></li>
  <li><a href="#extracting-and-viewing-components" id="toc-extracting-and-viewing-components" class="nav-link" data-scroll-target="#extracting-and-viewing-components"><span class="header-section-number">10.1.2</span> Extracting and Viewing Components</a></li>
  </ul>
</li>
  <li>
<a href="#analysing-autocorrelation-patterns" id="toc-analysing-autocorrelation-patterns" class="nav-link" data-scroll-target="#analysing-autocorrelation-patterns"><span class="header-section-number">10.2</span> Analysing Autocorrelation Patterns</a>
  <ul class="collapse">
<li><a href="#autocorrelation-function-acf" id="toc-autocorrelation-function-acf" class="nav-link" data-scroll-target="#autocorrelation-function-acf"><span class="header-section-number">10.2.1</span> Autocorrelation Function (ACF)</a></li>
  <li><a href="#partial-autocorrelation-function-pacf" id="toc-partial-autocorrelation-function-pacf" class="nav-link" data-scroll-target="#partial-autocorrelation-function-pacf"><span class="header-section-number">10.2.2</span> Partial Autocorrelation Function (PACF)</a></li>
  </ul>
</li>
  <li>
<a href="#feature-based-explorations" id="toc-feature-based-explorations" class="nav-link" data-scroll-target="#feature-based-explorations"><span class="header-section-number">10.3</span> Feature Based Explorations</a>
  <ul class="collapse">
<li><a href="#identifying-seasonal-patterns-and-strength" id="toc-identifying-seasonal-patterns-and-strength" class="nav-link" data-scroll-target="#identifying-seasonal-patterns-and-strength"><span class="header-section-number">10.3.1</span> Identifying Seasonal Patterns and Strength</a></li>
  <li><a href="#comprehensive-feature-analysis" id="toc-comprehensive-feature-analysis" class="nav-link" data-scroll-target="#comprehensive-feature-analysis"><span class="header-section-number">10.3.2</span> Comprehensive Feature Analysis</a></li>
  </ul>
</li>
  <li><a href="#comprehensive-diagnostic-plots-for-model-selection" id="toc-comprehensive-diagnostic-plots-for-model-selection" class="nav-link" data-scroll-target="#comprehensive-diagnostic-plots-for-model-selection"><span class="header-section-number">10.4</span> Comprehensive Diagnostic Plots for Model Selection</a></li>
  <li><a href="#summary-and-next-steps" id="toc-summary-and-next-steps" class="nav-link" data-scroll-target="#summary-and-next-steps"><span class="header-section-number">10.5</span> Summary and Next Steps</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./exploratory-analysis.html">Exploratory Time Series Analysis</a></li><li class="breadcrumb-item"><a href="./exploring-patterns.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-exploring-patterns-with-feasts-and-fabletools" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Visual inspection with <code>ggplot2</code> and <code>autoplot()</code> gives us an intuitive feel for our time series. We might suspect a trend, see hints of seasonality, and notice unusual observations. But how can we move from intuition to a more formal, statistical understanding of these components? This is where the <code>feasts</code> and <code>fabletools</code> package comes in.</p>
<p>The package <code>feasts</code>, which stands for <strong>F</strong>eature <strong>E</strong>xtraction <strong>A</strong>nd <strong>S</strong>tatistics for <strong>T</strong>ime <strong>S</strong>eries, is a core part of the tidyverts framework which we have mentioned earlier (<a href="intro.html" class="quarto-xref"><span>Chapter 1</span></a>). Its purpose is to provide a toolkit for analysing the <em>features</em> of a time series data (tsibble), while <code>fabletools</code> supplies the underlying infrastructure that makes this analysis seamless and efficient. Think of it as a Doctor’s diagnostic kit: It does not treat the patients (that is the job of forecasting models in <a href="simple-models.html" class="quarto-xref"><span>Chapter 14</span></a> and <a href="advanced-models.html" class="quarto-xref"><span>Chapter 15</span></a>), but it runs the tests needed to understand what is going on.</p>
<section id="decomposing-a-time-series-with-stl" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="decomposing-a-time-series-with-stl">
<span class="header-section-number">10.1</span> Decomposing a Time Series with <code>STL()</code>
</h2>
<p>A fundamental concept in time series analysis is decomposition. The idea is to split, <span class="math inline">\(y_{t}\)</span>, into three additive parts (where the time series is represented as the sum of its parts):</p>
<ul>
<li>
<strong>Trend (</strong><span class="math inline">\(T_{t}\)</span><strong>):</strong> The long-term progression (the increasing or decreasing direction over time)</li>
<li>
<strong>Seasonal (</strong><span class="math inline">\(S_{t}\)</span><strong>):</strong> Regular, repeating patterns over a fixed period (example, yearly or quarterly).</li>
<li>
<strong>Remainder (</strong><span class="math inline">\(R_{t}\)</span><strong>):</strong> The “leftover” part after trend and seasonality are removed; this is often considered the random noisy component.</li>
</ul>
<p><span class="math display">\[
y_{t}=Trend_{t}+Seasona_{t}+Remainder_{t}
\]</span></p>
<section id="basic-and-advanced-decomposition-with-special-arguments" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="basic-and-advanced-decomposition-with-special-arguments">
<span class="header-section-number">10.1.1</span> Basic and Advanced Decomposition with Special Arguments</h3>
<p>The most robust method for this <strong>STL,</strong> which stands for <strong>S</strong>easonal and <strong>T</strong>rend decomposition using <strong>L</strong>oess. Loess is a method for estimating non-linear relationships, and its use makes STL method versatile and robust to outliers as it handles a wide range of seasonal and trend shapes. The <code>feasts</code> package provides the <code>STL()</code> function to perform this decomposition directly on a <code>tsibble</code> object. Let us decompose the <code>Sales</code> series in the <code>sales_ts</code> data.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Decompose the Sales series using STL</span></span>
<span><span class="va">dcmp</span> <span class="op">&lt;-</span> <span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">model</span><span class="op">(</span><span class="fu">STL</span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The simplest implementation use the default <code>STL()</code> function, which automatically selects suitable window sizes for the trend and seasonal components as illustrated in the above code. The <code>model()</code> function from the <code>fabletools</code> package is used to fit a “model” (STL Decomposition) to the tsibble <code>sales_ts</code>. The variable to decomposed is specified inside the <code>STL</code> function.</p>
<p>For greater control you can include the variable of interest as a formula where you manually define the smoothing window for the trend and the seasonal components using the special arguments <code>trend</code> and <code>season</code>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># decompose Sales series using STL with special arguments</span></span>
<span><span class="va">dcmp_sp</span> <span class="op">&lt;-</span> <span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">model</span><span class="op">(</span>stl <span class="op">=</span> <span class="fu">STL</span><span class="op">(</span><span class="va">Sales</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span>window <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span> <span class="fu">season</span><span class="op">(</span>window <span class="op">=</span> <span class="st">"periodic"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>trend(window = 7)</code> sets the window size for the trend smoothing, specifying that a trend should be estimated using a window of <span class="math inline">\(2\times7+1=15\)</span> observations. This comes from how the <strong>Loess</strong> (Locally Estimated Scatterplot Smoothing) method is typically implemented within the STL algorithm to calculate the <strong>trend component</strong>. A larger window results in a smoother trend.</p>
</section><section id="extracting-and-viewing-components" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="extracting-and-viewing-components">
<span class="header-section-number">10.1.2</span> Extracting and Viewing Components</h3>
<p>The <code>dcmp</code> object we created now contains the fitted decomposition model. To see the results, we use the <code>components()</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># extract the components from the decomposition model</span></span>
<span><span class="fu">components</span><span class="op">(</span><span class="va">dcmp</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This returns a <code>fabletools</code> object dataset “<code>dable</code>” (decomposition table) which is a tsibble-like data structure for representing decompositions. It contains the original time index with the Sales series together with four new columns;</p>
<ul>
<li>
<code>trend</code>: The estimated trend component.</li>
<li>
<code>season_year</code>: The estimated seasonal component.</li>
<li>
<code>remainder</code>: The residual or error component (noise).</li>
<li>
<code>season_adjust</code>: The final seasonally adjusted series (Original Series - Seasonal Component)</li>
</ul>
<p>This allows for direct analysis and visualisation of how much of the variations in the <code>Sales</code> series is attributed to long-term movements, seasonal factors, and irregular noise. The <code>autoplot()</code> function when applied on this <code>dable</code> output will automatically generate a multi-panel plot displaying the decomposition of the <code>Sales</code> series into its components as calculated by the STL method.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">components</span><span class="op">(</span><span class="va">dcmp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">autoplot</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.
ℹ The deprecated feature was likely used in the ggtime package.
  Please report the issue to the authors.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="exploring-patterns_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot features for main panels; the original Sales time series (<span class="math inline">\(y_{t}\)</span>), The long term direction of the trend, the estimated periodic pattern and the noise or irregular fluctuations.</p>
<p>From the STL decomposed plot we see that the original series is highly affected by both seasonality and a trend. The smooth long-term trend shows the overall level of sales over the years. Its starts around 35000 and dips noticeably around early 2018 and then rises back up towards 40,000 by late 2019</p>
<p>The seasonal panel shows a strong, consistent repeating pattern. The vertical scale (from approximately -5000 to 5000) indicates the magnitude of the seasonal effect relative to the trend.</p>
<p>The last panel shows the irregular, left over variations (from approximately -10,000 to 10,000). The spikes are quite large relative to the seasonal components. This implies a high amount of <strong>irregular unexplained variability</strong> in the data. The large spikes indicate months where sales were unusually high or low, which could be attributed to a variety of factors.</p>
</section></section><section id="analysing-autocorrelation-patterns" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="analysing-autocorrelation-patterns">
<span class="header-section-number">10.2</span> Analysing Autocorrelation Patterns</h2>
<p>Another crucial property of time series is <strong>autocorrelation</strong>. Simply put, autocorrelation measures the relationship between a value in a series and its past values (called “lags”). For example, is today;s sales figure correlated with the sales figure from the same quarter last year? This is a key concept for building effective forecasting models.</p>
<p>The <code>feasts</code> package provides two very useful functions, <code>ACF</code> (Autocorrelation Function) and <code>PACF()</code> (Partial Autocorrelation Function) to do this. Below, we see how to check autocorrelation for our <code>Sales</code> series.</p>
<section id="autocorrelation-function-acf" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="autocorrelation-function-acf">
<span class="header-section-number">10.2.1</span> Autocorrelation Function (ACF)</h3>
<p>The <strong>ACF</strong> measures the correlation between a time series <span class="math inline">\(y_{t}\)</span> and its past values <span class="math inline">\(y_{t-k}\)</span> (where <span class="math inline">\(k\)</span> is the lag) at all observed lags, without isolating the effect of intermediate lags. High autocorrelation at a seasonal lag (e.g.&nbsp;lag 12 for monthly data) is a strong indicator of seasonality. We use the <code>ACF()</code> function to calculate these correlations for the <code>Sales</code> series</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute the Autocorrelation for Sales</span></span>
<span><span class="va">sales_acf</span> <span class="op">&lt;-</span> <span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ACF</span><span class="op">(</span><span class="va">Sales</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sales_acf</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 17 x 2 [1M]
       lag      acf
  &lt;cf_lag&gt;    &lt;dbl&gt;
1       1M -0.0897 
2       2M  0.0896 
3       3M -0.271  
4       4M -0.00704
5       5M -0.191  
# ℹ 12 more rows</code></pre>
</div>
</div>
<p>We can also specify the maximum number of lags to use for computing the correlations with the <code>lag_max</code> argument. By default it calculates this number using the formula “<span class="math inline">\(10\times log_{10}(N/m)\)</span>”.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute autocorrelation with specified lags</span></span>
<span><span class="va">sales_acf</span> <span class="op">&lt;-</span> <span class="va">sales_ts</span> <span class="op">|&gt;</span> <span class="fu">ACF</span><span class="op">(</span><span class="va">Sales</span>, lag_max <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The resulting <code>sales_acf</code> object is a tsibble that contains the correlation coefficient at the different lags. A significant spike at a particular lag indicates a strong relationship.</p>
<p>We can visualise the output for easier interpretation using <code>autoplot()</code>. The plot of the ACF displays a series of vertical lines known as <strong>correlogram</strong>, where the height of each line represents the correlation at that specific lag.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">sales_acf</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-acf" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="exploring-patterns_files/figure-html/fig-acf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Correlogram of Sales series Autocorrelations
</figcaption></figure>
</div>
</div>
</div>
<p>The dashed blue lines in the plot represents the significance bounds. Any bar extending outside these bounds is considered a statistically significant correlation. The spikes do not show any slow, steady decline in the values from positive to negative. This suggests there is no strong trend.</p>
<p>There is no single large significant spike at regular intervals (like at lag 12M or 24M for monthly data). This indicates a lack of strong consistent annual seasonality. However there is a pattern of significant spikes in the first few lags, followed by a series of alternating pattern of negative and positive correlations in the short term. This implies a short term cyclical behaviour with a period of about 6 months.</p>
<p>This is what this ACF plot might mean in a business context:</p>
<ul>
<li>A customer makes a purchase (<strong>Lag0</strong>).</li>
<li>The negative correlation at <strong>Lag 3</strong> suggests that three months after a purchase, sales tend to be opposite to what they were. If sales were high in a given month, they are likely to be low three months later and vice versa.</li>
<li>The positive correlation at <strong>Lag 6</strong> suggests that whatever the sales pattern was at a given time, it tends to <strong>repeat itself every 6 months</strong>.</li>
</ul>
<p>The other spikes later on at lag <strong>14, 15 and 18</strong> are likely harmonics of the primary 6-month cycle. Once a cyclical pattern is in the data, it can create correlations at multiple or fractions of its main period. They are part of the same underlying effect and not separate seasonal effects</p>
</section><section id="partial-autocorrelation-function-pacf" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="partial-autocorrelation-function-pacf">
<span class="header-section-number">10.2.2</span> Partial Autocorrelation Function (PACF)</h3>
<p>The <strong>PACF</strong> calculates the correlation between <span class="math inline">\(y_{t}\)</span> and <span class="math inline">\(y_{t-k}\)</span> <strong>after removing the influence of the</strong> <strong>intermediate lags</strong> <span class="math inline">\(y_{t-1}\)</span>, <span class="math inline">\(y_{t-2}\)</span>, <span class="math inline">\(\dots\)</span>, <span class="math inline">\(y_{t-(k-1)}\)</span>. This helps to precisely identify the direct relationship between the current observation and a past observation, filtering out the “flow-through” correlation effects. Think of it this way: The sales at lag 3 (3 months ago) might be correlated with sales today because;</p>
<ul>
<li>Sales today are correlated with sales at lag 1 (ACF at lag 1)</li>
<li>Sales at lag 1 are correlated with sales at lag2.</li>
<li>Sales at lag 2 are correlated with sales at lag 3.</li>
</ul>
<p>The PACF cuts through this chain and asks: “If I already know the values at lags 1 and 2, does lag 3 still provide new, direct information today?</p>
<p>The <code>PACF()</code> function is used to calculate the partial autocorrelations.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute the Partial Autocorrelation for Sales</span></span>
<span><span class="va">sales_pacf</span> <span class="op">&lt;-</span> <span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">PACF</span><span class="op">(</span><span class="va">Sales</span>, lag_max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sales_pacf</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 20 x 2 [1M]
       lag    pacf
  &lt;cf_lag&gt;   &lt;dbl&gt;
1       1M -0.0897
2       2M  0.0822
3       3M -0.260 
4       4M -0.0571
5       5M -0.170 
# ℹ 15 more rows</code></pre>
</div>
</div>
<p>similar to the ACF, the <code>sales_pacf</code> object also contains the partial autocorrelation values for each lag. We can again visualise this output using <code>autoplot()</code>. The PACF plot is primarily used to identify the <strong><em>order</em></strong> of an <strong><em>autoregressive</em></strong> <em>(<strong>AR</strong>)</em> component in a model</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sales_pacf</span> <span class="op">|&gt;</span> <span class="fu">autoplot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-pacf" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="exploring-patterns_files/figure-html/fig-pacf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: Correlogram of Sales series Partial Autocorrelations
</figcaption></figure>
</div>
</div>
</div>
<p>The most important aspect of our PACF plot is the behaviour in the first few lags. We notice that the is a significant negative spike at <strong>lag 3</strong>, with the subsequent lags generally becoming smaller and non significant, with no clear pattern. This is a classic signature of a PACF plot where the beginning few vertical bars shows a significant spike and the cuts off.</p>
<p>The PACF and ACF plots are considered diagnostic plots for identifying an ARIMA model’s specification (more information in <a href="advanced-models.html" class="quarto-xref"><span>Chapter 15</span></a>).</p>
</section></section><section id="feature-based-explorations" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="feature-based-explorations">
<span class="header-section-number">10.3</span> Feature Based Explorations</h2>
<p>Another powerful aspect of the <code>fabletools</code> is its ability to compute a wide array of summary statistics or features from a time series. This is incredibly useful when you have many series (like in the <code>gh_ts</code> data with several indicators) and you want to quickly understand their characteristics or group similar series together.</p>
<section id="identifying-seasonal-patterns-and-strength" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="identifying-seasonal-patterns-and-strength">
<span class="header-section-number">10.3.1</span> Identifying Seasonal Patterns and Strength</h3>
<p>The most common feature to compute is the <strong>seasonal strength</strong>, which measures quantitatively how dominant the recurring patterns are compared to the overall trend and random noise. This is typically done using the <strong>STL decomposition</strong>. We demonstrate this with the <code><a href="https://tsibbledata.tidyverts.org/reference/aus_production.html">tsibbledata::aus_production</a></code> tsibble dataset which contains the quarterly production of selected commodities in Australia.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert wide data to long </span></span>
<span><span class="va">aus_prod_long</span> <span class="op">&lt;-</span> <span class="va">aus_production</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">Quarter</span>, names_to <span class="op">=</span> <span class="st">'Product'</span>, values_to <span class="op">=</span> <span class="st">'Quantity'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate seasonal strength and other key features</span></span>
<span><span class="va">aus_prod_features</span> <span class="op">&lt;-</span> <span class="va">aus_prod_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">features</span><span class="op">(</span><span class="va">Quantity</span>, features <span class="op">=</span> <span class="va">feat_stl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display seasonal and trend metrics</span></span>
<span><span class="va">aus_prod_features</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Product</span>, <span class="fu">contains</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'seasonal'</span>, <span class="st">'trend'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Product     seasonal_strength_year seasonal_peak_year seasonal_trough_year
  &lt;chr&gt;                        &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;
1 Beer                         0.952                  0                    2
2 Bricks                       0.859                  3                    1
3 Cement                       0.834                  3                    1
4 Electricity                  0.906                  3                    1
5 Gas                          0.981                  3                    1
# ℹ 1 more row
# ℹ 1 more variable: trend_strength &lt;dbl&gt;</code></pre>
</div>
</div>
<p>You have to change the data to a long format so that the tsibble has a ‘key’ variable (<code>Product</code>). The structure is essential for the <code>fabletools</code> feature functions. The <code>features()</code> function calculates metrics based on the STL decomposition for each <code>Product</code> series separately. The <code>feat_stl</code> feature set automatically returns several key metrics including:</p>
<ul>
<li>
<strong><code>seasonal_strength_year</code></strong>: Measures the proportion of variance explained by the seasonal components. The values range between 0 and 1 (higher values mean stronger seasonality).</li>
<li>
<strong><code>seasonal_peak</code>/<code>seasonal_trough_year</code></strong>: Identifies the periods (Month for monthly data &amp; Quarter for Quarterly data) of highest and lowest seasonal activity</li>
<li>
<strong><code>trend_strength</code></strong>: Measures the proportion of variance explained by the trend component (higher values mean stronger trend)</li>
</ul></section><section id="comprehensive-feature-analysis" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="comprehensive-feature-analysis">
<span class="header-section-number">10.3.2</span> Comprehensive Feature Analysis</h3>
<p>Beyond standard seasonality, <code>fabletools</code> allows you to calculate a wide array of statistics that characterises every nuance of a time series’ behaviour, including measures of shape, volatility and distribution.</p>
<p><strong>STL Features for Non-Seasonal Characteristics</strong></p>
<p>The STL feature set offers metrics beyond simple strength, focusing on the <strong>shape</strong> of the trend and the nature of the remainder (noise).</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute stl feature set for non-seasonal (yearly) data </span></span>
<span><span class="va">stl_features</span> <span class="op">&lt;-</span> <span class="va">gh_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">features</span><span class="op">(</span><span class="va">value</span>, features <span class="op">=</span> <span class="fu">feature_set</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">'stl'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This line of code within the the <code>feature()</code> function; <code>faeture_set(tags = 'stl')</code> instructs <code>fabletools</code> to compute the full set of STL-related features. These features include;</p>
<ul>
<li><p><strong><code>trend_strength:</code></strong> Measures how strong the trend component is relative to the remainder (noise). Values close to 1 have strong trend and values close to zero have weak or no trend. Example “<em>Female population”</em> (<span class="math inline">\(0.9999953\)</span>) has and extremely strong trend but”<em>Annual GDP growth rate”</em> (<span class="math inline">\(0.3091004\)</span>) has a weak trend.</p></li>
<li><p><strong><code>spikiness:</code></strong> Measures the presence of sharp intermittent spikes in the remainder (noise) component. High values = more spiky/volatile. Example <em>“Rural Population”</em> has <strong>extremely high spikiness</strong> (<span class="math inline">\(2.086846\times10^{14}\)</span>), indicating major irregularities.</p></li>
<li><p><strong><code>linearity:</code></strong> Measures how linear the trend is (vs curved) based on fitting a linear model to the trend component. Positive values suggest trend can be well-approximated by a straight line. Negative values suggest non-linear trends. *“Cereal&nbsp;yield&nbsp;_kg&nbsp;per&nbsp;hectare”* (<span class="math inline">\(3395.64\)</span>) is highly linear.</p></li>
<li><p><strong><code>curvature:</code></strong> Measures the degree of bending in the trend. It complements linearity -captures how much the trend curves. Higher absolute values means more curved. <em>“Female population percentage”</em> (<span class="math inline">\(-1.741482\)</span>) shows negative curvature (concave down)</p></li>
<li><p><strong><code>stl_e_acf1:</code></strong> First order autocorrelation of the remainder component (lag1). The values ranges from -1 to 1. Values near 0 means remainders are random (which is good!). High positive or negative values indicates patterns left in residuals that the STL decomposition did not capture.</p></li>
<li><p><strong><code>stl_e_acf10:</code></strong> Sum of squares of the first 10 autocorrelations of the remainder. Measures the overall autocorrelation structure in residuals. Low values are good and high value indicate significant patterns remain in the residuals.</p></li>
</ul>
<p><strong>Custom Feature Calculations with Lambda Expressions</strong></p>
<p>If a desired feature is not pre-defined, you can compute it using a built in function or a simple lambda expression (a short, anonymous function)</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute any other features using their function or a lambda expression</span></span>
<span><span class="va">percentile_features</span> <span class="op">&lt;-</span> <span class="va">aus_prod_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">features</span><span class="op">(</span><span class="va">Quantity</span>, features <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>features = ~quantile(., na.rm=TRUE)</code> defines a custom function to run on the Quantity values. The <code>~</code> symbol creates the lambda expression and the <code>.</code> refers to the vector of time series values. This is a compact way of calculating the <span class="math inline">\(0^{th}\)</span>, <span class="math inline">\(25^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, <span class="math inline">\(75^{th}\)</span> and <span class="math inline">\(100^{th}\)</span> percentiles for each <code>Product</code> series, giving insight into its distribution and volatility range.</p>
<p><strong>Multiple Custom Features (List of Functions)</strong></p>
<p>You can also calculate several custom features simultaneously by passing a named list of functions to the <code>features</code> argument.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># for multiple custom features create a list of functions </span></span>
<span><span class="va">cent_tend_features</span> <span class="op">&lt;-</span> <span class="va">gh_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">features</span><span class="op">(</span><span class="va">value</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">.</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, median <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">.</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, mean <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cent_tend_features</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 4
  indicator_name                            sd     median       mean
  &lt;chr&gt;                                  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Annual GDP growth rate                 4.20        4.40       3.71
2 Annual population groeth rate          0.290       2.46       2.50
3 Cereal yield _kg per hectare         476.       1141.      1249.  
4 Crude death rate_per 1000 people       4.18       11.4       12.6 
5 Female population                4132889.    8127176    8926929.  
# ℹ 17 more rows</code></pre>
</div>
</div>
<p>The custom anonymous functions supplied to the <code>features</code> argument in a list, calculates t<strong>hree measures of central tendency and dispersion</strong>. For every indicator in the <code>gh_ts</code> data, the standard deviation (<code>sd</code>), the median, and the mean are calculated. This can help you understand the <strong>average level</strong> of the series and its overall volatility across the entire period.</p>
</section></section><section id="comprehensive-diagnostic-plots-for-model-selection" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="comprehensive-diagnostic-plots-for-model-selection">
<span class="header-section-number">10.4</span> Comprehensive Diagnostic Plots for Model Selection</h2>
<p>The <code>gg_tsdisplay()</code> function from the <code>feasts</code> package (now often found in the <code>ggtime</code> package) makes it possible to create specialised plots that combine multiple diagnostics to guide model selection. Especially an ARIMA model.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a comprehensive diagnostic plot for Gross National Expenditure</span></span>
<span><span class="va">gh_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Gross national expenditure (% of GDP)"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">gg_tsdisplay</span><span class="op">(</span><span class="va">value</span>, plot_type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comprehensive Diagnostic Plot for GNE (% of GDP)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Series plot, ACF, and PACF for model selection guidance"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-diag-plot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="exploring-patterns_files/figure-html/fig-diag-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: An Ensemble of TIme Series Plots Containing the Orignial Series(Top), ACF plot (bottom left) and PACF plot (bottom right)
</figcaption></figure>
</div>
</div>
</div>
<p>Here we filter the <code>gh_ts</code> data to isolate the specific series of interest; the <code>Gross national expenditure (% of GDP)</code> indicator. <code>gg_tsdisplay(value, plot_type = "partial")</code> generates a three panel plot:</p>
<ul>
<li>The main panel (top) shows the Series Plot of the <code>Gross national expenditure (% of GDP)</code> values over the time period</li>
<li>The bottom left panel shows the ACF</li>
<li>The bottom right panel shows the PACF (specified by <code>plot_type = "partial")</code> )</li>
</ul>
<p>The <code>plot_type</code> argument controls what type of plot is displayed in the bottom right panel it can either be a PACF, histogram, lagged scatterplot or spectral density depending on what you specify. The values that can be specified for this argument can be found in its help documentation.</p>
<p>The series show high <strong>volatility</strong> with <strong>no</strong> <strong>clear</strong> <strong>trend</strong>, the ACF shows a slow decay where the spikes remain significantly positive until <strong>lag 7</strong>, the PACF shows a <strong>sharp cut-off</strong> after <strong>Lag 1</strong>. All these indications serve as diagnostic signs for a forecasting model selection.</p>
</section><section id="summary-and-next-steps" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="summary-and-next-steps">
<span class="header-section-number">10.5</span> Summary and Next Steps</h2>
<p>In this chapter we moved beyond visual inspection and explored the <code>feasts</code> and <code>fabletools</code> package to perform a rigorous, quantitative diagnosis of our time series. We systematically:</p>
<ul>
<li><p>Decomposed the a time series using <code>STL</code> to isolate the trend, seasonal and remainder components.</p></li>
<li><p>Analysed autocorrelation with <code>ACF</code> and <code>PACF</code> to understand how each value depends on its past.</p></li>
<li><p>Quantified pattern strength using <code>features()</code> to calculate statistics like <code>seasonal_strength</code> and <code>trend_strenght</code>, confirming our visual observations with hard numbers.</p></li>
<li><p>Created diagnostic plots using <code>gg_tsdisplay()</code> to get comprehensive multi-panel view of a time series’ behaviour, which is essential for guiding our model selection.</p></li>
</ul>
<p>With a deep understanding of patterns in our data, we are now ready to build forecasting models. But before we do, a critical step remains. In the next section, we will cover <strong>“Preparing Data for Forecasting”</strong>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-rmarkdown2024" class="csl-entry" role="listitem">
Allaire, JJ, Yihui Xie, Christophe Dervieux, Jonathan McPherson, Javier Luraschi, Kevin Ushey, Aron Atkins, et al. 2024. <em><span class="nocase">rmarkdown</span>: Dynamic Documents for r</em>. <a href="https://github.com/rstudio/rmarkdown">https://github.com/rstudio/rmarkdown</a>.
</div>
<div id="ref-janitor" class="csl-entry" role="listitem">
Firke, Sam. 2024. <em><span class="nocase">janitor</span>: Simple Tools for Examining and Cleaning Dirty Data</em>. <a href="https://doi.org/10.32614/CRAN.package.janitor">https://doi.org/10.32614/CRAN.package.janitor</a>.
</div>
<div id="ref-rsample" class="csl-entry" role="listitem">
Frick, Hannah, Fanny Chow, Max Kuhn, Michael Mahoney, Julia Silge, and Hadley Wickham. 2025. <em><span class="nocase">rsample</span>: General Resampling Infrastructure</em>. <a href="https://doi.org/10.32614/CRAN.package.rsample">https://doi.org/10.32614/CRAN.package.rsample</a>.
</div>
<div id="ref-fpp3" class="csl-entry" role="listitem">
Hyndman, Rob. 2024. <em>Fpp3: Data for "Forecasting: Principles and Practice" (3rd Edition)</em>. <a href="https://doi.org/10.32614/CRAN.package.fpp3">https://doi.org/10.32614/CRAN.package.fpp3</a>.
</div>
<div id="ref-ggtime" class="csl-entry" role="listitem">
O’Hara-Wild, Mitchell, Cynthia A. Huang, Matthew Kay, and Rob Hyndman. 2025. <em><span class="nocase">ggtime</span>: Grammar of Graphics and Plot Helpers for Time Series Visualization</em>. <a href="https://doi.org/10.32614/CRAN.package.ggtime">https://doi.org/10.32614/CRAN.package.ggtime</a>.
</div>
<div id="ref-fable" class="csl-entry" role="listitem">
O’Hara-Wild, Mitchell, Rob Hyndman, and Earo Wang. 2024. <em><span class="nocase">fable</span>: Forecasting Models for Tidy Time Series</em>. <a href="https://doi.org/10.32614/CRAN.package.fable">https://doi.org/10.32614/CRAN.package.fable</a>.
</div>
<div id="ref-feasts" class="csl-entry" role="listitem">
———. 2025. <em><span class="nocase">feasts</span>: Feature Extraction and Statistics for Time Series</em>. <a href="https://doi.org/10.32614/CRAN.package.feasts">https://doi.org/10.32614/CRAN.package.feasts</a>.
</div>
<div id="ref-tsibbledata" class="csl-entry" role="listitem">
O’Hara-Wild, Mitchell, Rob Hyndman, Earo Wang, and Rakshitha Godahewa. 2022. <em><span class="nocase">tsibbledata</span>: Diverse Datasets for <span>“<span class="nocase">tsibble</span>”</span></em>. <a href="https://doi.org/10.32614/CRAN.package.tsibbledata">https://doi.org/10.32614/CRAN.package.tsibbledata</a>.
</div>
<div id="ref-patchwork" class="csl-entry" role="listitem">
Pedersen, Thomas Lin. 2025. <em><span class="nocase">patchwork</span>: The Composer of Plots</em>. <a href="https://doi.org/10.32614/CRAN.package.patchwork">https://doi.org/10.32614/CRAN.package.patchwork</a>.
</div>
<div id="ref-base" class="csl-entry" role="listitem">
R Core Team. 2025. <em><span>R</span>: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-slider" class="csl-entry" role="listitem">
Vaughan, Davis. 2024. <em><span class="nocase">slider</span>: Sliding Window Functions</em>. <a href="https://doi.org/10.32614/CRAN.package.slider">https://doi.org/10.32614/CRAN.package.slider</a>.
</div>
<div id="ref-tsibble" class="csl-entry" role="listitem">
Wang, Earo, Dianne Cook, and Rob J Hyndman. 2020. <span>“A New Tidy Data Structure to Support Exploration and Modeling of Temporal Data.”</span> <em>Journal of Computational and Graphical Statistics</em> 29 (3): 466–78. <a href="https://doi.org/10.1080/10618600.2019.1695624">https://doi.org/10.1080/10618600.2019.1695624</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-knitr2014" class="csl-entry" role="listitem">
Xie, Yihui. 2014. <span>“<span class="nocase">knitr</span>: A Comprehensive Tool for Reproducible Research in <span>R</span>.”</span> In <em>Implementing Reproducible Computational Research</em>, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC.
</div>
<div id="ref-knitr2015" class="csl-entry" role="listitem">
———. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
<div id="ref-knitr2025" class="csl-entry" role="listitem">
———. 2025. <em><span class="nocase">knitr</span>: A General-Purpose Package for Dynamic Report Generation in <span>R</span></em>. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
<div id="ref-rmarkdown2018" class="csl-entry" role="listitem">
Xie, Yihui, J. J. Allaire, and Garrett Grolemund. 2018. <em>R Markdown: The Definitive Guide</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown">https://bookdown.org/yihui/rmarkdown</a>.
</div>
<div id="ref-rmarkdown2020" class="csl-entry" role="listitem">
Xie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. <em>R Markdown Cookbook</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown-cookbook">https://bookdown.org/yihui/rmarkdown-cookbook</a>.
</div>
<div id="ref-kableExtra" class="csl-entry" role="listitem">
Zhu, Hao. 2024. <em><span class="nocase">kableExtra</span>: Construct Complex Table with <span>“<span class="nocase">kable</span>”</span> and Pipe Syntax</em>. <a href="https://doi.org/10.32614/CRAN.package.kableExtra">https://doi.org/10.32614/CRAN.package.kableExtra</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./visualising-trends.html" class="pagination-link" aria-label="Visualising Trends with `ggplot2` and `autoplot()`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code>autoplot()</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./forecast-prepare.html" class="pagination-link" aria-label="Preparing for Forecasting">
        <span class="nav-page-text">Preparing for Forecasting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, George Kyei Agyen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>