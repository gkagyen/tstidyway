<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>9&nbsp; Visualising Trends with ggplot2 and autoplot() – Timeseries Analysis - the Tidyverse Way</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./exploring-patterns.html" rel="next">
<link href="./exploratory-analysis.html" rel="prev">
<link href="./ts_book.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./exploratory-analysis.html">Exploratory Time Series Analysis</a></li><li class="breadcrumb-item"><a href="./visualising-trends.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code></code></span></a><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Timeseries Analysis - the Tidyverse Way</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/gkagyen/tstidyway" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./required-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Required Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./environment-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Setting Up Your RStudio Environment</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./tidy-timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Time Series Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timeseries-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tidy Time Series Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timegaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dealing with Time Gaps and Irregularities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Importing Data and Creating a tsibble (Bonus)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dates-and-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Dates and Time</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>lubridate</code> for Date Manipulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./new-time-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating Useful Time-Based Features</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./exploratory-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Time Series Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualising-trends.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code></code></span></span></a><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploring-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./forecast-prepare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparing for Forecasting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stabilise-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Transformations for Variance Stabilisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./check-stationary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Checking for Stationarity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./split-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Splitting Temporal Data for Modelling</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./forecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting with the fable Framework</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Simple Forecasting Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced Forecasting Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forecast-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Model Evaluation and Forecasting</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#visualising-trends-with-ggplot2-and-autoplot" id="toc-visualising-trends-with-ggplot2-and-autoplot" class="nav-link active" data-scroll-target="#visualising-trends-with-ggplot2-and-autoplot"><span class="header-section-number">10</span> Visualising Trends with <code>ggplot2</code> and <code>autoplot()</code></a>
  <ul class="collapse">
<li>
<a href="#basic-time-series-plots-with-ggplot2" id="toc-basic-time-series-plots-with-ggplot2" class="nav-link" data-scroll-target="#basic-time-series-plots-with-ggplot2"><span class="header-section-number">10.1</span> Basic Time Series Plots with <code>ggplot2</code></a>
  <ul class="collapse">
<li><a href="#line-plots-for-time-series" id="toc-line-plots-for-time-series" class="nav-link" data-scroll-target="#line-plots-for-time-series"><span class="header-section-number">10.1.1</span> Line Plots for Time Series</a></li>
  <li><a href="#introducing-autoplot" id="toc-introducing-autoplot" class="nav-link" data-scroll-target="#introducing-autoplot"><span class="header-section-number">10.1.2</span> Introducing <code>autoplot()</code></a></li>
  <li><a href="#enhancing-basic-plots" id="toc-enhancing-basic-plots" class="nav-link" data-scroll-target="#enhancing-basic-plots"><span class="header-section-number">10.1.3</span> Enhancing Basic Plots</a></li>
  </ul>
</li>
  <li>
<a href="#multiple-time-series-plots-for-comparison" id="toc-multiple-time-series-plots-for-comparison" class="nav-link" data-scroll-target="#multiple-time-series-plots-for-comparison"><span class="header-section-number">10.2</span> Multiple Time Series Plots for Comparison</a>
  <ul class="collapse">
<li><a href="#multiple-series-with-autoplot" id="toc-multiple-series-with-autoplot" class="nav-link" data-scroll-target="#multiple-series-with-autoplot"><span class="header-section-number">10.2.1</span> Multiple Series with <code>autoplot()</code></a></li>
  <li><a href="#faceted-plots" id="toc-faceted-plots" class="nav-link" data-scroll-target="#faceted-plots"><span class="header-section-number">10.2.2</span> Faceted Plots</a></li>
  </ul>
</li>
  <li>
<a href="#visualising-monthly-data" id="toc-visualising-monthly-data" class="nav-link" data-scroll-target="#visualising-monthly-data"><span class="header-section-number">10.3</span> Visualising Monthly Data</a>
  <ul class="collapse">
<li><a href="#seasonal-patterns-and-trends" id="toc-seasonal-patterns-and-trends" class="nav-link" data-scroll-target="#seasonal-patterns-and-trends"><span class="header-section-number">10.3.1</span> Seasonal Patterns and Trends</a></li>
  </ul>
</li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">10.4</span> Summary</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./exploratory-analysis.html">Exploratory Time Series Analysis</a></li><li class="breadcrumb-item"><a href="./visualising-trends.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code></code></span></a><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-visualising-trends-with-ggplot2-and-autoplot" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualising Trends with <code>ggplot2</code> and <code>autoplot()</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This is where we transform the raw data (tabular data) into compelling stories that reveal patterns, trends and insights hidden in your data. Since we now have control over date manipulations and feature engineering from the previous chapters, visualisation is the next crucial step.</p>
<p>A well crafted plot can instantly reveal what might take hours to discover through numerical analysis alone. In this chapter we will learn how to visualise our time series data using the flexible, customisable world of <code>ggplot2</code> and the specialised, intelligent <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function from the <code>feasts</code> package.</p>
<section id="visualising-trends-with-ggplot2-and-autoplot" class="level1" data-number="10"><h1 data-number="10">
<span class="header-section-number">10</span> Visualising Trends with <code>ggplot2</code> and <code>autoplot()</code>
</h1>
<p>This is where we transform the raw data (tabular data) into compelling stories that reveal patterns, trends and insights hidden in your data. Since we now have control over date manipulations and feature engineering from the previous chapters, visualisation is the next crucial step.</p>
<p>A well crafted plot can instantly reveal what might take hours to discover through numerical analysis alone. In this chapter we will learn how to visualise our time series data using the flexible, customisable world of <code>ggplot2</code> and the specialised, intelligent <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function from the <code>feasts</code> package.</p>
<section id="basic-time-series-plots-with-ggplot2" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="basic-time-series-plots-with-ggplot2">
<span class="header-section-number">10.1</span> Basic Time Series Plots with <code>ggplot2</code>
</h2>
<section id="line-plots-for-time-series" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="line-plots-for-time-series">
<span class="header-section-number">10.1.1</span> Line Plots for Time Series</h3>
<p>We will start with the most fundamental time series visualisation, the line plot. It is perfect for showing how values change over time</p>
<p>To demonstrate this we will use the <code>gh_ts</code> tsibble data and filter some few key indicators (<code>Population_total</code>, <code>Life expectancy at birth</code>, <code>infant mortality_per_1000_births</code> and <code>Cereal yield _kg per hectare</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># select key variables for tsibble for exploration </span></span>
<span><span class="va">gh_key</span> <span class="op">&lt;-</span> <span class="va">gh_ts</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>     </span>
<span>    <span class="va">indicator_name</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>       </span>
<span>      <span class="st">"Population_total"</span>,       </span>
<span>      <span class="st">"Life expectancy at birth"</span>,       </span>
<span>      <span class="st">"Infant mortality_per_1000_births"</span>,       </span>
<span>      <span class="st">"Cereal yield _kg per hectare"</span>     </span>
<span>      <span class="op">)</span>   </span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After filtering our data into a manageable subset (<code>gh_key</code>), we can now go ahead and create individual line plots for each of the four indicators filtered on. We will use the same basic <code>ggplot2</code> syntax to produce these plots where we define aesthetics (<code>aes</code>), specify the geometry (<code>geom_line</code> for a line plot) and add labels (<code>labs</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># basic line plot for population total </span></span>
<span><span class="va">pop_plot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Population_total"</span><span class="op">)</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Annual Total Population (1960-2024)"</span>,     </span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Total Population"</span>   <span class="op">)</span>  </span>
<span><span class="va">pop_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gh-pop" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gh-pop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-gh-pop-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gh-pop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Time Series Plot of Ghana Annual Total Population from 1960 to 2024
</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># basic line plot for life expectancy at birth </span></span>
<span><span class="va">lifexp_plot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Life expectancy at birth"</span><span class="op">)</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Yearly Life Expectancy at Birth (1960-2024)"</span>,     </span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Life Expectancy at Birth"</span>   <span class="op">)</span>  </span>
<span><span class="va">lifexp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gh-lifexp" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gh-lifexp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-gh-lifexp-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gh-lifexp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: Time Series Plot of Ghana Yearly Life Expectancy at Birth from 1960 to 2024
</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># basic line plot for infant mortality </span></span>
<span><span class="va">Infmort_plot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Infant mortality_per_1000_births"</span><span class="op">)</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Annual Infant Mortality (1960-2024)"</span>,     </span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Infant Mortality/1000 births"</span>   <span class="op">)</span>  </span>
<span><span class="va">Infmort_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gh-inf-mort" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gh-inf-mort-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-gh-inf-mort-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gh-inf-mort-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: Time Series Plot of Ghana Yearly Infant Mortality from 1960 to 2024
</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># basic line plot for cereal yield </span></span>
<span><span class="va">cyield_plot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Cereal yield _kg per hectare"</span><span class="op">)</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Yearly Cereal Yield (1960-2024)"</span>,     </span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Cereal Yield/Hectare"</span><span class="op">)</span>  </span>
<span><span class="va">cyield_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gh-cereal" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gh-cereal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-gh-cereal-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gh-cereal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.4: Time Series Plot of Ghana Annual Cereal Yield from 1960 to 2024
</figcaption></figure>
</div>
</div>
</div>
<p>Each of the above code block generates a standard line plot for one of the selected indicators. this line of code <code>ggplot(aes(x = date, y = value))</code> sets up the aesthetic mapping with time (<code>date</code>) on the x-axis and the values (<code>value</code>) on the y-axis. <code>geom_line()</code> creates the line connecting the data points and the <code>linewidth = 0.7</code> sets the thickness of the line produced. The <code>labs()</code> function makes it possible to add informative titles and labels to the plots which you can specify as a string of texts (characters).</p>
<p>We can clearly see the <strong>dominant</strong> time series characteristic of these plots which is a <strong>strong trend</strong>. The annual total population plot shows a <strong>steep, continuous upward trend</strong> which signifies an accelerated population growth over the entire 64 year period. The life expectancy plot also shows a similar <strong>strong, persistent positive trend,</strong> illustrating how life expectancy has increased from around 45yrs between 1960 and 1970 to over 65yrs in 2024. This sharp increase can be attributed to improved medical care, public health and nutrition over the decades.</p>
<p>The plot for annual infant mortality has a <strong>continuous negative trend</strong>, indicating how infant mortality has fallen dramatically, dropping from over 120 per 1000 births in 1960 to under 30 in 2024. This reinforces the conclusion of improving health and sanitation from the life expectancy plot. The yearly cereal yield over the 64-year period also shows a generally <strong>positive long-term trend,</strong> but with significant fluctuations (spikes and dips) compared to the other plots. A pronounced upward acceleration is visible after the mid 1980s and especially after 2000. The sharp rise after 1980 likely reflects the intervention of the IMF (international monetary fund) and adoption of the Economic Recovery Program (ERP) in 1983 which significantly boosted the countries economy and reduced poverty levels.</p>
</section><section id="introducing-autoplot" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="introducing-autoplot">
<span class="header-section-number">10.1.2</span> Introducing <code>autoplot()</code>
</h3>
<p>Whiles ggplot gives you control, <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> from the feasts package provides intelligent defaults specifically designed for time series data. We can plot the same cereal yield time series in <a href="#fig-gh-cereal" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> with the <code>autoplt()</code> function using the code below</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># simple autoplot for cereal yield</span></span>
<span><span class="va">cyield_autoplot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Cereal yield _kg per hectare"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">autoplot</span><span class="op">(</span><span class="va">value</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Yearly Cereal Yield (1960-2024)"</span>,     </span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Cereal Yield/Hectare"</span><span class="op">)</span> </span>
<span><span class="va">cyield_autoplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cereal-autoplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cereal-autoplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-cereal-autoplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cereal-autoplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.5: Time Series Plot of Ghana Annual Cereal Yield from 1960 to 2024 using the autoplot function
</figcaption></figure>
</div>
</div>
</div>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function is quick and saves time with aesthetic mappings and geometry specifications when using traditional <code>ggplot2</code> layers. Although it actually is a specialised <code>ggplot2</code> function, it automatically respects the <strong>index</strong> (time) and <strong>key</strong> (series) of the time series data (<code>tsibble</code>). It chooses appropriate geometry, formats date axes appropriately and applies sensible styling. All other <code>ggplot2</code> graphical layers can be added to the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> like we do in traditional <code>ggplot2</code> graphs.</p>
</section><section id="enhancing-basic-plots" class="level3" data-number="10.1.3"><h3 data-number="10.1.3" class="anchored" data-anchor-id="enhancing-basic-plots">
<span class="header-section-number">10.1.3</span> Enhancing Basic Plots</h3>
<p>Let us make our <code>cyield_plot</code> more informative by adding some additional features and improving the styling.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># basic line plot for cereal yield </span></span>
<span><span class="va">enhanced_cyield_plot</span> <span class="op">&lt;-</span> <span class="va">gh_key</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">indicator_name</span> <span class="op">==</span> <span class="st">"Cereal yield _kg per hectare"</span><span class="op">)</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;=</span> <span class="fl">1000</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span></span>
<span>     na.translate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">'darkgreen'</span>,<span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">'red'</span>,<span class="st">"NA"</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">'False'</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">'True'</span>,<span class="st">"NA"</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"High Yield"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"1983-04-20"</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">'navy'</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">'dashed'</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>     </span>
<span>    title <span class="op">=</span> <span class="st">"Ghana Yearly Cereal Yield (1960-2024)"</span>, </span>
<span>    subtitle <span class="op">=</span> <span class="st">"Vertical line indicates Year of Adopting ERP Policy"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span>,     </span>
<span>    y <span class="op">=</span> <span class="st">"Cereal Yield per Hectare"</span></span>
<span>  <span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">'loess'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">enhanced_cyield_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gh-enhanced-cereal" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gh-enhanced-cereal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-gh-enhanced-cereal-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gh-enhanced-cereal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.6: Time Series Plot of Ghana Annual Total Cereal Yield with Additional Features to Enhance Visual Storytelling
</figcaption></figure>
</div>
</div>
</div>
<p>The plot above tells a detailed story about the Cereal Yield in Ghana from 1960 to 2024. Here we explicitly combine the time series data (<code>gh_key</code> ) with two very interesting <strong>engineered features</strong> – a <strong>threshold flag</strong> (red and green points) and a <strong>policy intervention marker</strong> (dashed vertical line) with a smoothed trend line (blue curved line). we use the <code>ggplot2</code> package to build this detailed visualisation layer by layer.</p>
<p>We start the whole process by filtering out the data to only include <code>cereal yield _kg per hectare</code> just like we did for <a href="#fig-gh-cereal" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> we then initialise our plot, mapping the <code>date</code> and <code>value</code> columns to the x and y-axis respectively. <code>geom_line(...)</code> draws the the raw time series data. Inside the <code>geom_point()</code> function we create a threshold flag (High Yield) where we add points to the time series line and the colour is determined by the logical expression <code>value &gt;= 1000</code>. If the yield is ≥ 1000, the colour is mapped to <code>TRUE</code> and if the yield is ˂ 1000, the colour is mapped to <code>FALSE.</code></p>
<p>We use <code>scale_colour_manual(...)</code> to explicitly assign <code>TRUE</code> and <code>FALSE</code> logical values to specific colours and label names where <code>TRUE</code> (High Yield) is mapped to <strong>dark green</strong> and <code>FALSE</code> (Low Yield) is mapped to <strong>red</strong>. <code>name = "High Yield"</code> sets the title of the legend to “High Yield”. The yield value filtered from the data contains some data so our logical expression will automatically return <code>NA</code>’s together with the logical flag of <code>TRUE</code> and <code>FALSE</code>. By default the <code>NA</code>’s a labelled as part of the legend so we need to explicitly omit them with <code>na.translate = FALSE</code> and then map its colour to <code>NULL</code>.</p>
<p>The next feature that enhances the plots visual appeal is a vertical line that marks the point of policy change, a crucial contextual feature. <code>geom_vline()</code> helps us to achieve this feat. It draws a vertical line fixed at a particular point on the x-axis. This fixed x-intercept is set at the exact date of the intervention corresponding to the adoption of Ghana’s Economic Recovery Program (ERP) using <code>xintercept = ymd("1983-04-20")</code>.</p>
<p>The final feature is a smoothed trend line which is drawn using the <strong>LOESS</strong> (Locally estimated Scatter-plot Smoothing) method with the help of <code>geom_smooth()</code>. This method is an excellent tool for creating flexible non-linear trend lines. <code>se = FALSE</code> suppresses the standard error band around the smooth line, keeping the plot clean. <code>theme(...)</code> is used to customise all aspects of the plot but for this we only use it to centre the <strong>title</strong> and <strong>subtitle</strong>.</p>
</section></section><section id="multiple-time-series-plots-for-comparison" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="multiple-time-series-plots-for-comparison">
<span class="header-section-number">10.2</span> Multiple Time Series Plots for Comparison</h2>
<section id="multiple-series-with-autoplot" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="multiple-series-with-autoplot">
<span class="header-section-number">10.2.1</span> Multiple Series with <code>autoplot()</code>
</h3>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function truly shines when working with multiple time series data. However, it only works best when the series has the same value range since they are all plotted on a single graph.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gh_key</span> <span class="op">|&gt;</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">value</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gh_key</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">indicator_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Infant mortality_per_1000_births"</span>, <span class="st">"Life expectancy at birth"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">value</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-multi-auto-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-multi-auto-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-multi-auto-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multi-auto-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.7: _ “Multiple series with autoplot (different value scales)” _ “Multiple series with autoplot (resonable range value scale)”
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-multi-auto-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-multi-auto-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-multi-auto-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multi-auto-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.8: _ “Multiple series with autoplot (different value scales)” _ “Multiple series with autoplot (resonable range value scale)”
</figcaption></figure>
</div>
</div>
</div>
<p>Notice how the plot in <a href="#fig-multi-auto-1" class="quarto-xref">Figure&nbsp;<span>10.7</span></a> shows all the keys for all the series in the legend but the plot has only two lines representing <code>population_total</code> and <code>life expectancy at birth</code>. This happens because all the 4 series keys have varying range of values that would not fit perfectly in a single plot with a fixed scale. For example <code>Population_total</code> (in tens of millions) alongside <code>life expectancy at birth</code> (in hundreds) on the same y-axis renders the smaller series nearly flat and invisible.</p>
<p>The plot in <a href="#fig-multi-auto-2" class="quarto-xref">Figure&nbsp;<span>10.8</span></a> however is able to display all the two series keys in the legend because their value ranges fall within the y-axis scale of values although their appearance do not truly reflect their true characteristic if they were visualised individually as seen in <a href="#fig-gh-inf-mort" class="quarto-xref">Figure&nbsp;<span>10.3</span></a> and <a href="#fig-gh-lifexp" class="quarto-xref">Figure&nbsp;<span>10.2</span></a>.</p>
</section><section id="faceted-plots" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="faceted-plots">
<span class="header-section-number">10.2.2</span> Faceted Plots</h3>
<p>To overcome the hurdle of inconsistent series value ranges on a single axis, we can facet our plots into separate panels using <code>facet_wrap()</code> from <code>ggplot2</code> together with the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function. This allows each series to use its own optimised y-axis scale, enabling clear visual comparison of trends and patterns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gh_key</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">autoplot</span><span class="op">(</span><span class="va">value</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">indicator_name</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Multiple Indicators in Ghana"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Faceted by Variable"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">'Year'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># remove legend from plot</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-facet" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-facet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-facet-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-facet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.9: Faceted Time Series Plot of All Keys within the <code>gh_key</code> tsibble Dataset
</figcaption></figure>
</div>
</div>
</div>
<p>The code output displays or four plots – each in its own panel. The core function in the above code is <code>facet_wrap(vars(indicator_name),...)</code>. It tells ggplot2 to create a new, separate panel for every unique value found in the <code>indicator_name</code> column. The next critical aspect is <code>scales = 'free_y'</code>, which instructs the <code>facet_wrap()</code> function to allow the y-axis to vary independently in each panel. Without this all panels would share the same scale, defeating the purpose of faceting the series. We finally remove the <strong>legend</strong> using <code>theme(legend.position = 'none')</code> since the series labels become redundant because they are given by the facet titles.</p>
<p>Faceted plots are the standard, most effective way to visualise multiple disparate time series data streams.</p>
</section></section><section id="visualising-monthly-data" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="visualising-monthly-data">
<span class="header-section-number">10.3</span> Visualising Monthly Data</h2>
<p>So far we have only seen the series plot of yearly data from the <code>gh_ts</code> data set. While the yearly visuals is a good way of identifying long term trends it mostly lacks seasonality. On the other hand a monthly dataset has monthly frequency, which opens up possibilities for detecting cyclical <strong>seasonal patterns</strong></p>
<section id="seasonal-patterns-and-trends" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="seasonal-patterns-and-trends">
<span class="header-section-number">10.3.1</span> Seasonal Patterns and Trends</h3>
<p>To demonstrate seasonal patterns which is mostly common in monthly datasets (repeating every 12 months) we will use the <code>sales_ts</code> tsibble.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Basic monthly time series plot</span></span>
<span><span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">autoplot</span><span class="op">(</span><span class="va">Sales</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Monthly Sales (2015-2019)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sales (₵)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">autoplot</span><span class="op">(</span><span class="va">Units_Sold</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Monthly Items Sold (2015-2019)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Items"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-month-plot-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-month-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-month-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-month-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.10: A time Series Plot Showing Monthly Frequency of Sales from 2015 to 2019
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-month-plot-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-month-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-month-plot-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-month-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.11: Another Similar Time Series Plot From the Same Data But Showing Monthly Items Sold from 2019 to 2015
</figcaption></figure>
</div>
</div>
</div>
<p>The two plots show some similar patterns, which is expected since sales is directly related to items sold.</p>
<p>The monthly sales series exhibits repeating seasonal peaks and troughs within each year and the pattern appears to involve some distinct high months (peaks) and low months (valleys) annually. This is the <strong>annual seasonality</strong> that most monthly datasets reveal. We can equally visualise the seasonal plot using the <code><a href="https://rdrr.io/pkg/ggtime/man/gg_season.html">gg_season()</a></code> function from the <code>ggtime</code> package. It overcomes the limitations of a simple line plot for monthly data by separating the data by year and laying the seasonal patterns on top of one another</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggtime</span><span class="op">)</span></span>
<span><span class="va">sales_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtime/man/gg_season.html">gg_season</a></span><span class="op">(</span><span class="va">Sales</span>, period <span class="op">=</span> <span class="st">"1y"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Seasonal Plot: Monthly Sales by Year"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-season" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-season-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="visualising-trends_files/figure-html/fig-season-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-season-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.12: A Time Series Seasonal Sub-series Plot of Monthly Sales for 5 years
</figcaption></figure>
</div>
</div>
</div>
<p>In terms of trend, there is no clear strong long term trend (upward or downward) across the 5-year period. for the monthly series plot in <a href="#fig-month-plot-1" class="quarto-xref">Figure&nbsp;<span>10.10</span></a> and <a href="#fig-month-plot-2" class="quarto-xref">Figure&nbsp;<span>10.11</span></a>. The overall level of sales appears stationary fluctuating between GH₵10,000 and GH₵50,000. The seasonal plot however shows some declining trend in the 2016 season (olive green line) and a positive trend in the 2019 season (pink line).</p>
<p>The Sold items plot mirrors the Sales plot, showing the same seasonal pattern with minimal long-term trend. These plots confirm that any forecasting model for this data must account for the seasonal component.</p>
<p>In the next chapter we will delve into a more detailed visualisation of seasonal patterns ans trends.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code><a href="https://rdrr.io/pkg/ggtime/man/gg_season.html">gg_season()</a></code> function is part of the <code>feasts</code> package but has been <strong>deprecated</strong> and moved to the new <code>ggtime</code> package which was basically designed for visualising time series patterns. It contains functions for exploring time series patterns like trends, seasonality, cycles and holidays</p>
</div>
</div>
</section></section><section id="summary" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="summary">
<span class="header-section-number">10.4</span> Summary</h2>
<p>So far you have mastered how to visualise our time series data using basic line plots with <code>ggplot2</code> and <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>. You have seen how <code>ggplot2</code> grants <strong>absolute control</strong> over every detail of your time series visualisations and how <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> delivers smart <strong>time series-specific</strong> defaults which drastically accelerates initial data exploration.</p>
<p>You can now make basic time series plots that reveal long term trends and seasonal cycles and also visualise multiple series simultaneously for comparative analysis.</p>
<p>In the next chapter, we are going to dive deeper into the <code>feasts</code> package to explore advanced time series decomposition, autocorrelation analysis and statistical pattern detection. The visual foundation we have built here will help us interpret those more advanced analysis.</p>
<p>Remember that visualisation is both an <strong>art</strong> and a <strong>science</strong>. The best plots are those that not only look good but also communicate clear, accurate insights about your time series data. Practice creating different types of visualisations and always consider what story your data is trying to tell!</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./exploratory-analysis.html" class="pagination-link" aria-label="Exploratory Time Series Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Exploratory Time Series Analysis</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./exploring-patterns.html" class="pagination-link" aria-label="Exploring Patterns with `feasts` and `fabletools`">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploring Patterns with <code>feasts</code> and <code>fabletools</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, George Kyei Agyen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>