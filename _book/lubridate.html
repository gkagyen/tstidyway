<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>7&nbsp; Using Lubridate for Date Manipulation – Timeseries Analysis - the Tidyverse Way</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./new-time-variables.html" rel="next">
<link href="./dates-and-time.html" rel="prev">
<link href="./ts_book.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dates-and-time.html">Working with Dates and Time</a></li><li class="breadcrumb-item"><a href="./lubridate.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>Lubridate</code> for Date Manipulation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Timeseries Analysis - the Tidyverse Way</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/gkagyen/tstidyway" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./required-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Required Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./environment-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Setting Up Your RStudio Environment</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./tidy-timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Time Series Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timeseries-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tidy Time Series Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timegaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dealing with Time Gaps and Irregularities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Importing Data and Creating a tsibble (Bonus)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dates-and-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Dates and Time</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lubridate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>Lubridate</code> for Date Manipulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./new-time-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating Useful Time-Based Features</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#understanding-date-formats" id="toc-understanding-date-formats" class="nav-link active" data-scroll-target="#understanding-date-formats"><span class="header-section-number">7.1</span> Understanding Date Formats</a></li>
  <li><a href="#working-with-real-data" id="toc-working-with-real-data" class="nav-link" data-scroll-target="#working-with-real-data"><span class="header-section-number">7.2</span> Working with Real Data</a></li>
  <li><a href="#date-arithmetic" id="toc-date-arithmetic" class="nav-link" data-scroll-target="#date-arithmetic"><span class="header-section-number">7.3</span> Date Arithmetic</a></li>
  <li><a href="#handling-time-zones" id="toc-handling-time-zones" class="nav-link" data-scroll-target="#handling-time-zones"><span class="header-section-number">7.4</span> Handling Time Zones</a></li>
  <li>
<a href="#common-date-challenges-and-solutions" id="toc-common-date-challenges-and-solutions" class="nav-link" data-scroll-target="#common-date-challenges-and-solutions"><span class="header-section-number">7.5</span> Common Date Challenges and Solutions</a>
  <ul class="collapse">
<li><a href="#handling-multiple-date-formats" id="toc-handling-multiple-date-formats" class="nav-link" data-scroll-target="#handling-multiple-date-formats"><span class="header-section-number">7.5.1</span> Handling Multiple Date Formats</a></li>
  <li><a href="#working-with-partial-dates-and-creating-sequences" id="toc-working-with-partial-dates-and-creating-sequences" class="nav-link" data-scroll-target="#working-with-partial-dates-and-creating-sequences"><span class="header-section-number">7.5.2</span> Working with Partial Dates and Creating Sequences</a></li>
  </ul>
</li>
  <li>
<a href="#periods-vs-durations" id="toc-periods-vs-durations" class="nav-link" data-scroll-target="#periods-vs-durations"><span class="header-section-number">7.6</span> Periods vs Durations</a>
  <ul class="collapse">
<li><a href="#the-core-difference" id="toc-the-core-difference" class="nav-link" data-scroll-target="#the-core-difference"><span class="header-section-number">7.6.1</span> The Core Difference</a></li>
  </ul>
</li>
  <li><a href="#best-practices-and-next-steps" id="toc-best-practices-and-next-steps" class="nav-link" data-scroll-target="#best-practices-and-next-steps"><span class="header-section-number">7.7</span> Best Practices and Next Steps</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dates-and-time.html">Working with Dates and Time</a></li><li class="breadcrumb-item"><a href="./lubridate.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>Lubridate</code> for Date Manipulation</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-using-lubridate-for-date-manipulation" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using <code>Lubridate</code> for Date Manipulation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Now that we know how to create a tidy time series data (<code>tsibble</code>) we will dive deeper into manipulating dates and times using the powerful <code>lubridate</code> package (part of the tidyverse package collection). In R this package makes working with dates and times very intuitive. In this chapter you will learn how to:</p>
<ul>
<li><p>Parse dates from various formats</p></li>
<li><p>Extract components from dates (year, month, day etc.)</p></li>
<li><p>Perform date arithmetic</p></li>
<li><p>Handle time zones and durations</p></li>
</ul>
<p>We will explore these features using some in-built datasets from the <code>tsibble</code> package. Make sure all required packages are loaded</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ─────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
Registered S3 method overwritten by 'tsibble':
  method               from 
  as_tibble.grouped_df dplyr


Attaching package: 'tsibble'


The following object is masked from 'package:lubridate':

    interval


The following objects are masked from 'package:base':

    intersect, setdiff, union


Loading required package: fabletools</code></pre>
</div>
</div>
<section id="understanding-date-formats" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="understanding-date-formats">
<span class="header-section-number">7.1</span> Understanding Date Formats</h2>
<p>Dates come in many formats: “2025-01-22”, “22/01/2025”, “January 22, 2025”, 22-Jan-2025”. Without <code>lubridate</code> parsing these can be frustrating.</p>
<p><code>lubridate</code> provides intuitive functions that match the order of your date components</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Different date formats parsed easily</span></span>
<span><span class="va">date1</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2023-03-15"</span><span class="op">)</span>        <span class="co"># Year-Month-Day</span></span>
<span><span class="va">date2</span> <span class="op">&lt;-</span> <span class="fu">dmy</span><span class="op">(</span><span class="st">"15/03/2023"</span><span class="op">)</span>        <span class="co"># Day-Month-Year  </span></span>
<span><span class="va">date3</span> <span class="op">&lt;-</span> <span class="fu">mdy</span><span class="op">(</span><span class="st">"March 15, 2023"</span><span class="op">)</span>    <span class="co"># Month-Day-Year</span></span>
<span><span class="va">date4</span> <span class="op">&lt;-</span> <span class="fu">dmy</span><span class="op">(</span><span class="st">"15-Mar-2023"</span><span class="op">)</span>       <span class="co"># Day-Month-Year with text month</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>date1, date2, date3 and date4 all produces the same results thanks to <code>lubridate</code>’s intuitive functions <code>ymd</code>, <code>dmy</code>, and <code>mdy</code>.</p>
</section><section id="working-with-real-data" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="working-with-real-data">
<span class="header-section-number">7.2</span> Working with Real Data</h2>
<p>We will use the <code>pedestrian</code> dataset from the <code>tsibble</code> package which contains hourly pedestrian counts from sensors around Melbourne in Australia. We will practice our <code>lubridate</code> skills on this data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pedestrian</span><span class="op">)</span></span>
<span><span class="co">## # A tsibble: 6 x 5 [1h] &lt;Australia/Melbourne&gt;</span></span>
<span><span class="co">## # Key:       Sensor [1]</span></span>
<span><span class="co">##   Sensor         Date_Time           Date        Time Count</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">## 1 Birrarung Marr 2015-01-01 00:00:00 2015-01-01     0  1630</span></span>
<span><span class="co">## 2 Birrarung Marr 2015-01-01 01:00:00 2015-01-01     1   826</span></span>
<span><span class="co">## 3 Birrarung Marr 2015-01-01 02:00:00 2015-01-01     2   567</span></span>
<span><span class="co">## 4 Birrarung Marr 2015-01-01 03:00:00 2015-01-01     3   264</span></span>
<span><span class="co">## 5 Birrarung Marr 2015-01-01 04:00:00 2015-01-01     4   139</span></span>
<span><span class="co">## # ℹ 1 more row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see that this data is already a tsibble with a proper Datetime (stored as a <strong>POSIXct</strong> object) column <code>Date_Time</code> (<strong>index</strong>). The <code>Sensor</code> column is the <strong>key</strong> and it contains the various sensor names. The <code>Date</code> represents the date the counts were recorded, the <code>Time</code> is the hour associated with the Date_Time and the <code>Count</code> is the hourly pedestrian count.</p>
<p>Our main variable of interest is the <code>Date_Time</code>, we will isolate this column and see how to extract various components from these time stamps</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R <code>POSIXct</code> is a class used to represent dates and times. It stores date-time information as the number of seconds that have elapsed since January 1, 1970 at 00:00:00 UTC</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Isolate Date_Time column from the rest of the data</span></span>
<span><span class="va">pedestrain_date_times</span> <span class="op">&lt;-</span> <span class="va">pedestrian</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is an hourly timestamp which contains lots of temporal information. We will go ahead and extract components using functions from the <code>lubridate</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># extract a single timestamp</span></span>
<span><span class="va">single_timestamp</span> <span class="op">&lt;-</span> <span class="va">pedestrain_date_times</span><span class="op">$</span><span class="va">Date_Time</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># extract temporal components</span></span>
<span><span class="fu">year</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>               <span class="co"># extract year</span></span>
<span><span class="fu">month</span><span class="op">(</span><span class="va">single_timestamp</span>, </span>
<span>      label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co"># extract month</span></span>
<span><span class="fu">day</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>                <span class="co"># extract day of month</span></span>
<span><span class="fu">wday</span><span class="op">(</span><span class="va">single_timestamp</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># extract day of week (Mon - Sun)</span></span>
<span><span class="fu">hour</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>               <span class="co"># extract hour</span></span>
<span><span class="fu">minute</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>             <span class="co"># extract minute</span></span>
<span><span class="fu">second</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>             <span class="co"># extract second</span></span>
<span><span class="fu">quarter</span><span class="op">(</span><span class="va">single_timestamp</span><span class="op">)</span>                  <span class="co"># extract quarter of year</span></span>
<span><span class="fu">semester</span><span class="op">(</span><span class="va">single_timestamp</span>, with_year <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>  <span class="co"># extract semester of year </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>year</code> function extracts a four digit year from the <code>single-timestamp</code> variable. The month function extracts the month from the date, by default it extracts a numeric month but specifying <code>label=TRUE</code> changes the numeric month to a named month (e.g.&nbsp;from 2 to February). Again the <code>abbr</code> argument control whether the name of the month should be abbreviated or not. the <code>day</code> and <code>wday</code> functions extracts the day of the month and the day of the week respectively. specifying <code>label=TRUE</code> in <code>wday</code> behaves the same way as in the <code>month</code> function. The <code>hour</code>, <code>minute</code> and <code>second</code> functions extracts the hour of the day (0-23), the minute (0-59) and second (0-59) respectively. The <code>quarter</code> function returns the fiscal quarter of the year (1-4) and the <code>semester</code> function returns either 1 or 2 for each semester of the year. A quarter divides the year into 4 (3 months in each quarter) and the semester divides the year into 2 (6-months in each semester).</p>
</section><section id="date-arithmetic" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="date-arithmetic">
<span class="header-section-number">7.3</span> Date Arithmetic</h2>
<p><code>lubridate</code> also contains functions to perform simple arithmetic on dates. This type of manipulation can be vital when preparing your data for time series modelling. we will use the same <code>single timestamp</code> variable to demonstrate this.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># rename to start date</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="va">single_timestamp</span></span>
<span></span>
<span><span class="co"># perform various date calculations</span></span>
<span><span class="va">start_date</span> <span class="op">+</span> <span class="fu">days</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">start_date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">start_date</span> <span class="op">+</span> <span class="fu">years</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">days_in_month</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">-</span> <span class="fu">day</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span></span>
<span><span class="fu">wday</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">)</span>   <span class="co"># check is day is a weekend (Sat or Sun)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line of code for the arithmetic calculations adds exactly 7 days to the original date. The new date now becomes <strong>“2015-01-08 03:00:00 AEDT”.</strong> The second line of code adds exactly 2 calendar months. <code>lubridate</code> correctly handles complexities like moving from January 31st to February 28th/29th. The third line adds exactly one calendar year (correctly handling leap years). <code>days_in_month(start_date) - day(start_date)</code> calculates how many days remain in the current month. It subtracts the current day of the month from the total number of days in that month. The last line of code creates a logical flag (TRUE/FALSE) indicating if the <code>start_date</code> is a Saturday <code>(7)</code> or a Sunday <code>(1)</code>, based on R’s default week-starting convention.</p>
</section><section id="handling-time-zones" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="handling-time-zones">
<span class="header-section-number">7.4</span> Handling Time Zones</h2>
<p>Here we learn the critical concept of time zone handling using <code>lubridate</code>. We will use the <code>pedestrian</code> data which contains dates in the <code>"AEDT"</code> (Australian Eastern Daylight Time) [The time zone in Melbourne] time zone and convert them into various global time zones. This demonstrates how the same moment in time is represented differently around the world.</p>
<p>We will first sample a few timelines from the pedestrian data and the use the <code>with_tz()</code> function to convert these times to several international time zones</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sample time stamps (first 5) from data</span></span>
<span><span class="va">time_examples</span> <span class="op">&lt;-</span> <span class="va">pedestrain_date_times</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">time_examples</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 2</span></span>
<span><span class="co">##   Date_Time           Sensor        </span></span>
<span><span class="co">##   &lt;dttm&gt;              &lt;chr&gt;         </span></span>
<span><span class="co">## 1 2015-01-01 00:00:00 Birrarung Marr</span></span>
<span><span class="co">## 2 2015-01-01 01:00:00 Birrarung Marr</span></span>
<span><span class="co">## 3 2015-01-01 02:00:00 Birrarung Marr</span></span>
<span><span class="co">## 4 2015-01-01 03:00:00 Birrarung Marr</span></span>
<span><span class="co">## 5 2015-01-01 04:00:00 Birrarung Marr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then go ahead to create new time zones (time zone conversion) from the original time zone as new columns in the data</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">more_time_examples</span> <span class="op">&lt;-</span> <span class="va">time_examples</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    utc_time <span class="op">=</span> <span class="fu">with_tz</span><span class="op">(</span><span class="va">Date_Time</span>, tzone <span class="op">=</span> <span class="st">'UTC'</span><span class="op">)</span>,</span>
<span>    london_time <span class="op">=</span> <span class="fu">with_tz</span><span class="op">(</span><span class="va">Date_Time</span>, tzone <span class="op">=</span> <span class="st">'Europe/London'</span><span class="op">)</span>,</span>
<span>    ny_time <span class="op">=</span> <span class="fu">with_tz</span><span class="op">(</span><span class="va">Date_Time</span>, tzone <span class="op">=</span> <span class="st">'America/New_York'</span><span class="op">)</span>,</span>
<span>    ghana_time <span class="op">=</span> <span class="fu">with_tz</span><span class="op">(</span><span class="va">Date_Time</span>, tzone <span class="op">=</span> <span class="st">'Africa/Accra'</span><span class="op">)</span>,</span>
<span>    timezone_offset <span class="op">=</span> <span class="fu">tz</span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">more_time_examples</span></span>
<span><span class="co">## # A tibble: 5 × 7</span></span>
<span><span class="co">##   Date_Time           Sensor        utc_time            london_time        </span></span>
<span><span class="co">##   &lt;dttm&gt;              &lt;chr&gt;         &lt;dttm&gt;              &lt;dttm&gt;             </span></span>
<span><span class="co">## 1 2015-01-01 00:00:00 Birrarung Ma… 2014-12-31 13:00:00 2014-12-31 13:00:00</span></span>
<span><span class="co">## 2 2015-01-01 01:00:00 Birrarung Ma… 2014-12-31 14:00:00 2014-12-31 14:00:00</span></span>
<span><span class="co">## 3 2015-01-01 02:00:00 Birrarung Ma… 2014-12-31 15:00:00 2014-12-31 15:00:00</span></span>
<span><span class="co">## 4 2015-01-01 03:00:00 Birrarung Ma… 2014-12-31 16:00:00 2014-12-31 16:00:00</span></span>
<span><span class="co">## 5 2015-01-01 04:00:00 Birrarung Ma… 2014-12-31 17:00:00 2014-12-31 17:00:00</span></span>
<span><span class="co">## # ℹ 3 more variables: ny_time &lt;dttm&gt;, ghana_time &lt;dttm&gt;,</span></span>
<span><span class="co">## #   timezone_offset &lt;chr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>with_tz()</code> function facilitates the display of a date-time object (POSIXct) in a different time zone. It is crucial to understand that <code>with_tz()</code> does not alter the actual moment in time but rather changes the representation of that moment in a new time zone. It requires the date-time and the new time zone to do its magic for instance this code <code>ghana_time = with_tz(Date_Time, tzone = 'Africa/Accra'</code> converts the <code>Date_Time</code> object from its original time zone of <code>"AEDT"</code> into a new time zone <code>"Africa/Accra"</code> (“GMT”).</p>
<p>It recalculates the local clock time based on the new time zone while preserving the absolute point in time. This can result in changes to the displayed hour, day, or even date, depending on the time difference between the original and the target time zones as seen above.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can use the <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code> function to see the various time zone names in R</p>
</div>
</div>
</section><section id="common-date-challenges-and-solutions" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="common-date-challenges-and-solutions">
<span class="header-section-number">7.5</span> Common Date Challenges and Solutions</h2>
<p>Working with dates and times in real-world frequently presents two major challenges: <strong>Inconsistent formatting</strong> (messy strings) and the need to <strong>create continuous, regular sequences</strong> (to fill gaps). The <code>lubridate</code> package together with <code>dplyr</code> offer elegant solutions to both problems</p>
<section id="handling-multiple-date-formats" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="handling-multiple-date-formats">
<span class="header-section-number">7.5.1</span> Handling Multiple Date Formats</h3>
<p>When raw data comes from different sources, it may lead to dates stored as string/characters in unpredictable non-standard formats (<code>YYYY-MM-DD</code>). We demonstrate how to use an all purpose function <code>parse_date_time()</code> to handle such irregularities</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># simulate messy dates data</span></span>
<span><span class="va">messy_dates</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  date_string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"2016-01-01 08:00:00"</span>,</span>
<span>  <span class="st">"01/01/2016 09:00"</span>,</span>
<span>  <span class="st">"January 1, 2016 10:00"</span>,</span>
<span>  <span class="st">"01-Jan-2016 11:00"</span></span>
<span>   <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parse all formats using lubridates flexibility</span></span>
<span><span class="va">clean_dates</span> <span class="op">&lt;-</span> <span class="va">messy_dates</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    final_date <span class="op">=</span> <span class="fu">parse_date_time</span><span class="op">(</span></span>
<span>      <span class="va">date_string</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>,</span>
<span>        <span class="st">"%d/%m/%Y %H:%M"</span>,</span>
<span>        <span class="st">"%B %d, %Y %H:%M"</span>, </span>
<span>        <span class="st">"%d-%b-%Y %H:%M"</span><span class="op">)</span>,</span>
<span>      exact <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">clean_dates</span></span>
<span><span class="co">## # A tibble: 4 × 2</span></span>
<span><span class="co">##   date_string           final_date         </span></span>
<span><span class="co">##   &lt;chr&gt;                 &lt;dttm&gt;             </span></span>
<span><span class="co">## 1 2016-01-01 08:00:00   2016-01-01 08:00:00</span></span>
<span><span class="co">## 2 01/01/2016 09:00      2016-01-01 09:00:00</span></span>
<span><span class="co">## 3 January 1, 2016 10:00 2016-01-01 10:00:00</span></span>
<span><span class="co">## 4 01-Jan-2016 11:00     2016-01-01 11:00:00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is designed to specifically handle the scenarios where you have multiple possible date-time formats in a single vector. The <code>parse_date_time)</code> function requires the desired formats to be parsed via the <code>orders</code> argument using either R or C format codes (which begin with a percent sign <code>%</code>) or the more simplified intuitive <code>lubridate</code> non percent format like ( <code>ymd HMS</code>). The percent format date codes have meanings for the various letters;</p>
<ul>
<li>
<code>%Y</code>: 4-digit year (e.g 2016)</li>
<li>
<code>%m</code>, <code>%b</code> and <code>%B</code>: for months in numeric, abbreviated name and full name respectively</li>
<li>
<code>%d</code>: Day of month</li>
<li>
<code>%H</code>: Hour</li>
<li>
<code>%M</code>: Minute</li>
<li>
<code>%S</code>: Second</li>
</ul>
<p>You can find more information about these formats in the help documentation on the <code>parse_date_time()</code> function.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be careful when using the simplified intuitive <code>lubridate</code> format since it might not always parse the date correctly as expected</p>
</div>
</div>
</section><section id="working-with-partial-dates-and-creating-sequences" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="working-with-partial-dates-and-creating-sequences">
<span class="header-section-number">7.5.2</span> Working with Partial Dates and Creating Sequences</h3>
<p>Time series analysis often requires a complete, ordered sequence of time points, even if the raw data is sparse or irregular. We have already seen how to check and repair implicit missing time stamps in our data but what we want to learn here is to generate a series of dates/times between two specified endpoints. To achieve this, we can use <code>seq.Date</code> and <code><a href="https://rdrr.io/r/base/seq.POSIXt.html">seq.POSIXt()</a></code> to generate these continuous sequences. These two functions are all base R functions that can be very handy sometimes</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create date sequences for analysis</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">'2016-01-01'</span><span class="op">)</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">'2016-01-31'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate daily sequences</span></span>
<span><span class="va">daily_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>  to <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"day"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate hourly sequence for a specific day</span></span>
<span><span class="va">hourly_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.POSIXt.html">seq.POSIXt</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="st">"2016-01-15 00:00:00"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="st">"2016-01-15 23:00:00"</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"hour"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>seq.Date</code> is used for creating sequences of Date objects (without time components). It requires a <code>from</code> (start date), a <code>to</code> (end date), and a <code>by</code> (interval e.g.&nbsp;“day”, “month”, “year”). The output is a sequence of simple dates. <code>seq.POSIXT()</code> on the other hand is used to for Date-time (<code>POSIXt</code>) sequences. It requires a full start and end time and a time based interval (e.g.&nbsp;“hour”, “5 min”, “sec”). This is essential for high-frequency data.</p>
<p>These temporal sequence functions are the backbone of may time series operations, allowing you to create a <strong>time index</strong> that can be used to join sparse data, visualise gaps, or ensure a continuous flow of data points for modelling.</p>
</section></section><section id="periods-vs-durations" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="periods-vs-durations">
<span class="header-section-number">7.6</span> Periods vs Durations</h2>
<p>This sections deals with a sophisticated yet crucial concept in time series and date handling: the difference between a <strong>Period</strong> and a <strong>Duration</strong> in the <code>lubridate</code> package. This distinction is vital because adding a set amount of time (like “one month) does not always equal the same number of seconds or days, due to factors like month length, leap years, and Daylight Saving Time (DST).</p>
<section id="the-core-difference" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="the-core-difference">
<span class="header-section-number">7.6.1</span> The Core Difference</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header">
<th>Concept</th>
<th>Function type</th>
<th>Definition</th>
<th>Impact on Time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Period</td>
<td><code>years(), months(), days(), hours()</code></td>
<td>Represents a human-defined <strong>calendar-aware</strong> unit of time</td>
<td>The length in seconds is <strong>variable.</strong> Adding one month from January !st means landing exactly on February 1st</td>
</tr>
<tr class="even">
<td>Duration</td>
<td><code>dmonths(), dyears(), ddays(), dseconds(), dminutes()</code></td>
<td>Represents an <strong>exact, absolute</strong> span of time, measured in seconds</td>
<td>The length in seconds is fixed. Adding 1 month duration is always <strong>2,629,800</strong> seconds (the average month length)</td>
</tr>
</tbody>
</table>
<p>The code below demonstrates this sophistication</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># understanding the difference between periods and duration</span></span>
<span><span class="va">time_concepts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">'start of analysis period'</span>,</span>
<span>  start_time <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="st">"2016-01-01 00:00:00"</span><span class="op">)</span>,</span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="co"># periods respect calendar time </span></span>
<span>    add_1_month_period <span class="op">=</span> <span class="va">start_time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># duration respect exact time intervals (1month is always 30 days)</span></span>
<span>    add_1_month_duration <span class="op">=</span> <span class="va">start_time</span> <span class="op">+</span> <span class="fu">dmonths</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># difference between the two</span></span>
<span>    difference <span class="op">=</span> <span class="va">add_1_month_period</span> <span class="op">-</span> <span class="va">add_1_month_duration</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">time_concepts</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span></span>
<span>  <span class="va">start_time</span>,</span>
<span>  <span class="va">add_1_month_period</span>,</span>
<span>  <span class="va">add_1_month_duration</span>,</span>
<span>  <span class="va">difference</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 4</span></span>
<span><span class="co">##   start_time          add_1_month_period  add_1_month_duration difference</span></span>
<span><span class="co">##   &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;               &lt;drtn&gt;    </span></span>
<span><span class="co">## 1 2016-01-01 00:00:00 2016-02-01 00:00:00 2016-01-31 10:30:00  13.5 hours</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The period function <code><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months()</a></code> respects the calendar and it moves the date one calendar month forward regardless of whether January has 31 days. The duration function <code>dmonths()</code> uses a fixed conversion; <code>dmonths(1)</code> is the equivalent of 30.4375 days in duration logic. It is the average length of a month in a 12year calender <span class="math inline">\((\frac{365.25days}{12months})\)</span>. The difference between the duration month and the period month is recorded as <strong>13.5hrs.</strong> (under the <code>difference</code> column) not <strong>24hrs.</strong> (1day), this is because the two calculations used fundamentally different values for 1 month and that <code>dmonth(1)</code> ≠ <code>30days</code>.</p>
<p>This is how the difference is calculated</p>
<p><span class="math display">\[
Difference = \frac{(31days - 30.4375days)\times24hours}{1day}=13.5hours
\]</span></p>
<p>Using the wrong concept can lead to significant errors in analysis and forecast. For instance if you want to forecast the sales of the next calendar months you should use <strong>Periods</strong> (e.g.&nbsp;<code>start_date + months(1)</code>) to ensure the forecast window aligns with calendar cycles. If you want to compare today’s temperature to the temperature exactly 72hours ago, you must use <strong>Durations</strong> (e.g.&nbsp;<code>now() - ddays(3)</code>) to get a fixed time difference independent of DST changes. A period of <code>hours(72)</code> might skip an hour of DST changes leading to an incorrect comparison.</p>
<p><strong>Periods</strong> handle the complexities of DST and leap years transparently, preserving the clock time. <strong>Durations</strong> simply add or subtract the exact number of seconds.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The dataset <code>time_concepts</code> is created as a tibble intentionally just for demonstration purposes</p>
</div>
</div>
</section></section><section id="best-practices-and-next-steps" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="best-practices-and-next-steps">
<span class="header-section-number">7.7</span> Best Practices and Next Steps</h2>
<p>When dealing with dates and times in a times series you must always;</p>
<ul>
<li><p>Parse dates early in your analysis workflow</p></li>
<li><p>Use consistent date formats throughout the project</p></li>
<li><p>Be mindful of time zones when working with international dates</p></li>
<li><p>Validate your dates by checking for impossible dates and time gaps</p></li>
<li><p>Use the appropriate data types - <code>Date</code> for dates and <code>POSIXct</code> for date-times</p></li>
</ul>
<p>Now that you are comfortable with <code>lubridate</code>, you are ready to create powerful time-based features for your forecasting models. In the next section, we will learn how to transform these date components into meaningful predictors that can dramatically improve your time series forecasts.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./dates-and-time.html" class="pagination-link" aria-label="Working with Dates and Time">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Working with Dates and Time</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./new-time-variables.html" class="pagination-link" aria-label="Creating Useful Time-Based Features">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating Useful Time-Based Features</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, George Kyei Agyen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>